<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ°´æœå¯†ç ï¼šé€»è¾‘ç‰¹è®­</title>
    <style>
        :root {
            --bg-color: #F3E8FF;
            --primary: #C084FC; 
            --primary-dark: #A855F7;
            --slot-bg: #FFFFFF;
            --text-main: #4C1D95;
            
            /* çŠ¶æ€é¢œè‰² */
            --state-correct: #4ADE80; /* ç»¿ */
            --state-present: #FACC15; /* é»„ */
            --state-absent: #E5E7EB;  /* ç° */
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            height: 100vh;
            touch-action: manipulation;
            overflow: hidden;
        }

        /* --- å¯åŠ¨å±å¹• (æ¨¡å¼é€‰æ‹©) --- */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            z-index: 200;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
        }

        .mode-card {
            background: white; width: 100%; max-width: 320px;
            padding: 20px; border-radius: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center; cursor: pointer;
            border: 2px solid transparent; transition: all 0.2s;
        }
        .mode-card:active { transform: scale(0.98); background: #fafafa; }
        .mode-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 5px; color: var(--text-main); }
        .mode-desc { font-size: 0.9rem; color: #666; }
        
        /* --- é¡¶éƒ¨æ  --- */
        header {
            padding: 15px; background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        h1 { margin: 0; font-size: 1.2rem; color: var(--primary-dark); }
        .btn-icon {
            background: none; border: 2px solid var(--primary); color: var(--primary);
            border-radius: 50%; width: 32px; height: 32px; font-weight: bold; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- æ¸¸æˆä¸»åŒºåŸŸ --- */
        .game-board {
            flex: 1; overflow-y: auto; padding: 20px;
            display: flex; flex-direction: column-reverse; /* æ–°è®°å½•åœ¨åº•éƒ¨ */
            gap: 10px;
        }

        .guess-row {
            display: flex; align-items: center; justify-content: center;
            gap: 10px; animation: slideIn 0.3s ease-out;
            background: rgba(255,255,255,0.5);
            padding: 8px; border-radius: 15px;
        }

        .turn-number { font-size: 0.8rem; color: #999; width: 20px; text-align: center; }

        .slots-container { display: flex; gap: 6px; }

        .slot {
            width: 45px; height: 45px;
            background: var(--slot-bg); border-radius: 10px;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.8rem; border: 2px solid transparent;
            transition: all 0.4s;
        }

        /* è½»æ¾æ¨¡å¼ä¸‹çš„æ ·å¼ */
        .slot.correct { background-color: var(--state-correct) !important; color: white; border-color: var(--state-correct); }
        .slot.present { background-color: var(--state-present) !important; color: white; border-color: var(--state-present); }
        .slot.absent  { background-color: var(--state-absent) !important; opacity: 0.6; }

        /* å¤§å¸ˆæ¨¡å¼ä¸‹çš„åé¦ˆåŒº */
        .feedback-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 4px; width: 24px;
            margin-left: 5px;
        }
        .peg { width: 10px; height: 10px; border-radius: 50%; background: #ddd; }
        .peg.green { background: var(--state-correct); box-shadow: 0 0 5px var(--state-correct); } /* ä½ç½®å¯¹ */
        .peg.white { background: white; border: 1px solid #ccc; } /* ä»…é¢œè‰²å¯¹ */

        .current-row .slot { border-color: var(--primary); background: white; }

        /* --- åº•éƒ¨é”®ç›˜ --- */
        .controls-area {
            background: white; padding: 15px 15px 30px 15px;
            border-radius: 25px 25px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); flex-shrink: 0;
        }
        .keypad { display: flex; justify-content: space-between; gap: 5px; margin-bottom: 15px; }
        .key-btn {
            background: #F5F3FF; border: none; border-radius: 10px; padding: 12px 0;
            flex: 1; font-size: 1.6rem; cursor: pointer; box-shadow: 0 3px 0 #DDD6FE;
        }
        .key-btn:active { transform: translateY(2px); box-shadow: none; }
        .action-btns { display: flex; gap: 10px; }
        .action-btn {
            flex: 1; padding: 12px; border-radius: 12px; border: none;
            font-weight: bold; font-size: 1rem; cursor: pointer;
        }
        .btn-del { background: #FEE2E2; color: #991B1B; }
        .btn-check { background: var(--primary); color: white; }

        /* --- å¼¹çª— --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none;
            justify-content: center; align-items: center; z-index: 300;
            backdrop-filter: blur(2px);
        }
        .modal-content {
            background: white; padding: 30px; width: 85%; max-width: 350px;
            border-radius: 20px; text-align: center;
            animation: pop 0.3s;
        }
        .secret-reveal { font-size: 2.2rem; letter-spacing: 5px; margin: 15px 0; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); }}
        @keyframes pop { from { transform: scale(0.8); } to { transform: scale(1); }}
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="font-size: 2rem; margin-bottom: 30px; color: var(--primary-dark);">ğŸ“ æ°´æœå¯†ç </h1>
        
        <div class="mode-card" onclick="selectMode('modern')">
            <div class="mode-title">ğŸ­ è½»æ¾æ¨¡å¼ (æ¨è)</div>
            <div class="mode-desc">æ ¼å­ç›´æ¥å˜è‰²ï¼Œç›´è§‚ç®€å•</div>
            <div style="margin-top:10px; display:flex; justify-content:center; gap:5px;">
                <div style="width:20px;height:20px;background:var(--state-correct);border-radius:4px;"></div>
                <div style="width:20px;height:20px;background:var(--state-present);border-radius:4px;"></div>
            </div>
        </div>

        <div class="mode-card" onclick="selectMode('classic')">
            <div class="mode-title">ğŸ§  å¤§å¸ˆæ¨¡å¼ (çƒ§è„‘)</div>
            <div class="mode-desc">çœ‹æ—è¾¹çš„å°åœ†ç‚¹çŒœé€»è¾‘</div>
            <div class="mode-desc" style="font-size:0.8rem; margin-top:5px;">(åœ†ç‚¹ä¸å¯¹åº”å…·ä½“ä½ç½®)</div>
             <div style="margin-top:10px; display:flex; justify-content:center; gap:5px;">
                <div style="width:10px;height:10px;background:var(--state-correct);border-radius:50%;"></div>
                <div style="width:10px;height:10px;background:#fff;border:1px solid #ccc;border-radius:50%;"></div>
            </div>
        </div>
    </div>

    <div id="game-container" style="display:none; flex-direction:column; height:100%;">
        <header>
            <button class="btn-icon" onclick="location.reload()">ğŸ </button>
            <h1 id="game-title">æ¨¡å¼æ ‡é¢˜</h1>
            <button class="btn-icon" onclick="showHelp()">?</button>
        </header>

        <div class="game-board" id="board"></div>

        <div class="controls-area">
            <div class="keypad">
                <button class="key-btn" onclick="inputItem('ğŸ')">ğŸ</button>
                <button class="key-btn" onclick="inputItem('ğŸŒ')">ğŸŒ</button>
                <button class="key-btn" onclick="inputItem('ğŸ‡')">ğŸ‡</button>
                <button class="key-btn" onclick="inputItem('ğŸ“')">ğŸ“</button>
                <button class="key-btn" onclick="inputItem('ğŸ‘')">ğŸ‘</button>
                <button class="key-btn" onclick="inputItem('ğŸˆ')">ğŸˆ</button>
            </div>
            <div class="action-btns">
                <button class="action-btn btn-del" onclick="deleteItem()">â¬…ï¸ æ’¤é”€</button>
                <button class="action-btn btn-check" onclick="checkGuess()">âœ… æäº¤</button>
            </div>
        </div>
    </div>

    <div class="modal" id="help-modal">
        <div class="modal-content" style="text-align: left;">
            <h3 style="text-align: center; margin-top:0;">ç©æ³•è¯´æ˜</h3>
            <div id="help-content-modern" style="display:none;">
                <p><strong>è½»æ¾æ¨¡å¼ï¼š</strong></p>
                <p>ğŸŸ© <strong>ç»¿è‰²æ ¼å­</strong>ï¼šä½ç½®ã€æ°´æœå…¨å¯¹ã€‚</p>
                <p>ğŸŸ¨ <strong>é»„è‰²æ ¼å­</strong>ï¼šæ°´æœå¯¹äº†ï¼Œä½†ä½ç½®ä¸å¯¹ã€‚</p>
                <p>â¬œ <strong>ç°è‰²æ ¼å­</strong>ï¼šå¯†ç é‡Œæ²¡è¿™ä¸ªæ°´æœã€‚</p>
            </div>
            <div id="help-content-classic" style="display:none;">
                <p><strong>å¤§å¸ˆæ¨¡å¼ï¼š</strong></p>
                <p>æ³¨æ„ï¼šåé¦ˆç‚¹åœ¨å³ä¾§ï¼Œ<strong>ä¸å¯¹åº”</strong>ä½ç½®ï¼</p>
                <hr>
                <p>ğŸŸ¢ <strong>ç»¿ç‚¹</strong>ï¼šæœ‰å‡ ä¸ªæ°´æœçš„ä½ç½®å®Œå…¨æ­£ç¡®ã€‚</p>
                <p>âšª <strong>ç™½ç‚¹</strong>ï¼šæœ‰å‡ ä¸ªæ°´æœç§ç±»å¯¹ä½†ä½ç½®é”™ã€‚</p>
                <p>âŒ <strong>æ— ç‚¹</strong>ï¼šå®Œå…¨é”™è¯¯ã€‚</p>
            </div>
            <button class="action-btn btn-check" style="width:100%; margin-top:15px;" onclick="closeModal('help-modal')">æ˜ç™½äº†</button>
        </div>
    </div>

    <div class="modal" id="result-modal">
        <div class="modal-content">
            <h2 id="result-title"></h2>
            <p id="result-msg"></p>
            <div class="secret-reveal" id="secret-display"></div>
            <button class="action-btn btn-check" onclick="location.reload()">è¿”å›ä¸»èœå•</button>
        </div>
    </div>

    <script>
        const ITEMS = ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸ“', 'ğŸ‘', 'ğŸˆ'];
        let secretCode = [];
        let currentGuess = [];
        let turn = 1;
        let isGameOver = false;
        let currentMode = 'modern'; // 'modern' or 'classic'
        const maxTurns = 10;

        // --- 1. æ¨¡å¼é€‰æ‹©ä¸åˆå§‹åŒ– ---
        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'flex';
            
            const titleMap = {
                'modern': 'ğŸ­ è½»æ¾æ¨¡å¼',
                'classic': 'ğŸ§  å¤§å¸ˆæ¨¡å¼'
            };
            document.getElementById('game-title').innerText = titleMap[mode];

            initGame();
        }

        function initGame() {
            secretCode = [];
            for(let i=0; i<4; i++) {
                secretCode.push(ITEMS[Math.floor(Math.random() * ITEMS.length)]);
            }
            console.log("ç­”æ¡ˆ: ", secretCode);
            
            currentGuess = [];
            turn = 1;
            isGameOver = false;
            document.getElementById('board').innerHTML = '';
            renderCurrentRow();
        }

        // --- 2. æ¸¸æˆæ“ä½œ ---
        function inputItem(item) {
            if(isGameOver || currentGuess.length >= 4) return;
            currentGuess.push(item);
            updateRowDisplay();
        }

        function deleteItem() {
            if(isGameOver || currentGuess.length === 0) return;
            currentGuess.pop();
            updateRowDisplay();
        }

        // --- 3. æ¸²æŸ“é€»è¾‘ ---
        function renderCurrentRow() {
            const board = document.getElementById('board');
            const row = document.createElement('div');
            row.className = 'guess-row current-row';
            row.id = `row-${turn}`;
            
            let slotsHtml = '';
            for(let i=0; i<4; i++) {
                slotsHtml += `<div class="slot" id="slot-${turn}-${i}"></div>`;
            }

            let feedbackHtml = '';
            if (currentMode === 'classic') {
                // åªæœ‰ç»å…¸æ¨¡å¼æ‰æ¸²æŸ“å³ä¾§çš„å°åœ†ç‚¹åŒºåŸŸ
                feedbackHtml = `
                    <div class="feedback-grid" id="feedback-${turn}">
                        <div class="peg"></div><div class="peg"></div>
                        <div class="peg"></div><div class="peg"></div>
                    </div>
                `;
            }

            row.innerHTML = `
                <div class="turn-number">#${turn}</div>
                <div class="slots-container">${slotsHtml}</div>
                ${feedbackHtml}
            `;
            
            board.prepend(row);
        }

        function updateRowDisplay() {
            for(let i=0; i<4; i++) {
                const slot = document.getElementById(`slot-${turn}-${i}`);
                slot.innerText = currentGuess[i] || '';
                if(currentGuess[i]) {
                    slot.style.borderColor = '#ddd';
                    slot.style.background = '#fff';
                } else {
                    slot.style.borderColor = 'transparent';
                }
            }
        }

        // --- 4. æ ¸å¿ƒåˆ¤æ–­é€»è¾‘ (åˆ†æµ) ---
        function checkGuess() {
            if(currentGuess.length !== 4) return;

            const row = document.getElementById(`row-${turn}`);
            row.classList.remove('current-row');

            let won = false;

            if (currentMode === 'modern') {
                won = checkModernLogic();
            } else {
                won = checkClassicLogic();
            }

            if (won) {
                endGame(true);
            } else if (turn >= maxTurns) {
                endGame(false);
            } else {
                turn++;
                currentGuess = [];
                renderCurrentRow();
            }
        }

        // --- é€»è¾‘A: è½»æ¾æ¨¡å¼ (Wordle é€»è¾‘ - æ ¼å­å˜è‰²) ---
        function checkModernLogic() {
            const results = [null, null, null, null];
            const secretCheck = [...secretCode];
            const guessCheck = [...currentGuess];
            let correctCount = 0;

            // ç»¿
            for (let i = 0; i < 4; i++) {
                if (guessCheck[i] === secretCheck[i]) {
                    results[i] = 'correct';
                    secretCheck[i] = null;
                    guessCheck[i] = null;
                    correctCount++;
                }
            }
            // é»„
            for (let i = 0; i < 4; i++) {
                if (results[i] === null) {
                    const foundIndex = secretCheck.indexOf(guessCheck[i]);
                    if (foundIndex !== -1) {
                        results[i] = 'present';
                        secretCheck[foundIndex] = null;
                    } else {
                        results[i] = 'absent';
                    }
                }
            }

            // åŠ¨ç”»æ˜¾ç¤º
            for(let i=0; i<4; i++) {
                const slot = document.getElementById(`slot-${turn}-${i}`);
                setTimeout(() => {
                    slot.classList.add(results[i]);
                }, i * 100);
            }
            
            return correctCount === 4;
        }

        // --- é€»è¾‘B: å¤§å¸ˆæ¨¡å¼ (Mastermind é€»è¾‘ - å³ä¾§åœ†ç‚¹) ---
        function checkClassicLogic() {
            let exactMatches = 0; // Green pegs
            let partialMatches = 0; // White pegs
            
            const secretCheck = [...secretCode];
            const guessCheck = [...currentGuess];

            // 1. ç®—å®Œå…¨åŒ¹é…
            for (let i = 0; i < 4; i++) {
                if (guessCheck[i] === secretCheck[i]) {
                    exactMatches++;
                    secretCheck[i] = null;
                    guessCheck[i] = 'checked';
                }
            }

            // 2. ç®—é¢œè‰²åŒ¹é… (ä½ç½®ä¸å¯¹)
            for (let i = 0; i < 4; i++) {
                if (guessCheck[i] !== 'checked') {
                    const idx = secretCheck.indexOf(guessCheck[i]);
                    if (idx !== -1) {
                        partialMatches++;
                        secretCheck[idx] = null;
                    }
                }
            }

            // 3. æ¸²æŸ“åœ†ç‚¹ (æ³¨æ„ï¼šè¿™é‡Œä¸æŒ‰é¡ºåºæ¸²æŸ“ï¼Œè€Œæ˜¯å…ˆç»¿åç™½ï¼Œä¸å‘Šè¯‰ç©å®¶å…·ä½“æ˜¯å“ªä¸ª)
            const pegs = document.getElementById(`feedback-${turn}`).querySelectorAll('.peg');
            let pegIdx = 0;
            
            // å…ˆå¡«ç»¿ç‚¹
            for(let i=0; i<exactMatches; i++) {
                pegs[pegIdx].classList.add('green');
                pegIdx++;
            }
            // å†å¡«ç™½ç‚¹
            for(let i=0; i<partialMatches; i++) {
                pegs[pegIdx].classList.add('white');
                pegIdx++;
            }

            return exactMatches === 4;
        }


        // --- è¾…åŠ©åŠŸèƒ½ ---
        function endGame(win) {
            isGameOver = true;
            setTimeout(() => {
                const modal = document.getElementById('result-modal');
                const title = document.getElementById('result-title');
                
                document.getElementById('secret-display').innerText = secretCode.join(' ');
                title.innerText = win ? "ğŸ‰ ç ´è§£æˆåŠŸï¼" : "ğŸ˜­ è€—å°½æ¬¡æ•°";
                title.style.color = win ? "var(--state-correct)" : "#EF4444";
                
                document.getElementById('result-msg').innerText = win 
                    ? `ä½ çœŸæ˜¯ä¸ªé€»è¾‘å¤©æ‰ï¼(${turn}æ¬¡)` 
                    : "åˆ«ç°å¿ƒï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š";
                    
                modal.style.display = 'flex';
            }, 600);
        }

        function showHelp() {
            document.getElementById('help-modal').style.display = 'flex';
            if (currentMode === 'modern') {
                document.getElementById('help-content-modern').style.display = 'block';
                document.getElementById('help-content-classic').style.display = 'none';
            } else {
                document.getElementById('help-content-modern').style.display = 'none';
                document.getElementById('help-content-classic').style.display = 'block';
            }
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }
    </script>
</body>
</html>
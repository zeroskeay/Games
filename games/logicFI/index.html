<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F/I é€»è¾‘ç‰¹è®­ï¼šå…³å¡ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f1f5f9; color: #334155; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        /* å…³å¡å¡ç‰‡æ ·å¼ */
        .level-card {
            transition: all 0.3s ease;
            border-bottom: 4px solid #e2e8f0;
        }
        .level-card:hover:not(.locked) {
            transform: translateY(-4px);
            border-bottom-color: #6366f1;
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.15);
        }
        .level-card.locked { opacity: 0.6; cursor: not-allowed; filter: grayscale(1); }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen flex flex-col">
        
        <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
            <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
                <div class="flex items-center gap-2 cursor-pointer" @click="view = 'menu'">
                    <div class="bg-indigo-600 text-white w-8 h-8 rounded flex items-center justify-center font-bold">F/I</div>
                    <span class="font-bold text-lg tracking-tight text-slate-800">é€»è¾‘ç‰¹è®­</span>
                </div>
                
                <div v-if="view === 'training'" class="flex items-center gap-4">
                    <div class="text-xs font-bold text-slate-400 uppercase tracking-wider">
                        å…³å¡ {{ currentLevelIndex + 1 }}
                    </div>
                    <div class="bg-slate-100 px-3 py-1 rounded-full text-sm font-mono font-bold text-indigo-600">
                        {{ currentQIndex + 1 }} / {{ currentLevelData.length }}
                    </div>
                </div>
            </div>
        </nav>

        <main class="flex-grow container mx-auto max-w-4xl p-6">

            <div v-if="view === 'menu'" class="animate-fade-in space-y-8">
                <div class="text-center space-y-2 py-8">
                    <h1 class="text-3xl font-bold text-slate-800">äº‹å®ä¸æ¨æ–­åˆ†ç¦»è®­ç»ƒ</h1>
                    <p class="text-slate-500">æ¯å…³ 10 é¢˜ï¼Œå¼ºåŒ–ä½ çš„æ‰¹åˆ¤æ€§æ€ç»´æŠ¤ç›¾ã€‚</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div v-for="(lvl, idx) in levels" :key="idx" 
                         @click="startLevel(idx)"
                         :class="['level-card bg-white p-6 rounded-xl border border-slate-200 relative overflow-hidden', isLocked(idx) ? 'locked' : 'cursor-pointer']">
                        
                        <div class="flex justify-between items-start mb-4">
                            <span class="bg-slate-100 text-slate-600 text-xs font-bold px-2 py-1 rounded uppercase">Level {{ idx + 1 }}</span>
                            <i v-if="isLocked(idx)" class="ri-lock-line text-slate-300 text-xl"></i>
                            <i v-else-if="levelStatus[idx]" class="ri-checkbox-circle-fill text-green-500 text-xl"></i>
                            <i v-else class="ri-play-circle-line text-indigo-500 text-xl"></i>
                        </div>
                        
                        <h3 class="text-lg font-bold text-slate-800 mb-2">{{ getLevelTitle(idx) }}</h3>
                        <p class="text-sm text-slate-500 mb-4">åŒ…å« 10 ç»„é€»è¾‘é™·é˜±æ‹†è§£è®­ç»ƒã€‚</p>
                        
                        <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                            <div class="h-full bg-green-500" :style="{ width: levelStatus[idx] ? '100%' : '0%' }"></div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-12">
                    <button @click="view = 'free'" class="text-slate-400 hover:text-indigo-600 text-sm font-medium transition">
                        <i class="ri-edit-box-line mr-1"></i> è¿›å…¥è‡ªç”±åˆ†ææ¨¡å¼
                    </button>
                </div>
            </div>

            <div v-else-if="view === 'training'" class="max-w-3xl mx-auto animate-fade-in">
                <div class="w-full bg-slate-200 h-1.5 rounded-full mb-6 overflow-hidden">
                    <div class="bg-indigo-600 h-full transition-all duration-500" 
                         :style="{ width: ((currentQIndex + 1) / currentLevelData.length) * 100 + '%' }"></div>
                </div>

                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-8 bg-slate-50 border-b border-slate-100">
                        <div class="flex gap-2 mb-3">
                            <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded font-bold">{{ currentQuestion.tag }}</span>
                            <span class="px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded font-bold">{{ currentQuestion.difficulty }}</span>
                        </div>
                        <h2 class="text-2xl font-serif text-slate-800 leading-relaxed">
                            â€œ{{ currentQuestion.text }}â€
                        </h2>
                    </div>

                    <div class="p-8 grid md:grid-cols-2 gap-8">
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-bold text-green-700 flex items-center gap-1"><i class="ri-focus-2-line"></i> Fact (äº‹å®)</label>
                                <button @click="addInput('facts')" class="text-green-600 hover:bg-green-50 rounded p-1"><i class="ri-add-line"></i></button>
                            </div>
                            <div v-for="(val, i) in userAnswers.facts" :key="'f'+i" class="relative">
                                <input v-model="userAnswers.facts[i]" class="w-full bg-green-50/50 border border-green-200 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 outline-none" placeholder="è¾“å…¥å®¢è§‚äº‹å®...">
                                <button @click="removeInput('facts', i)" class="absolute right-2 top-2 text-gray-400 hover:text-red-500" v-if="userAnswers.facts.length > 1"><i class="ri-close-line"></i></button>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <label class="text-sm font-bold text-amber-700 flex items-center gap-1"><i class="ri-lightbulb-line"></i> Inference (æ¨æ–­)</label>
                                <button @click="addInput('inferences')" class="text-amber-600 hover:bg-amber-50 rounded p-1"><i class="ri-add-line"></i></button>
                            </div>
                            <div v-for="(val, i) in userAnswers.inferences" :key="'i'+i" class="relative">
                                <input v-model="userAnswers.inferences[i]" class="w-full bg-amber-50/50 border border-amber-200 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 outline-none" placeholder="è¾“å…¥ä¸»è§‚æ¨æ–­...">
                                <button @click="removeInput('inferences', i)" class="absolute right-2 top-2 text-gray-400 hover:text-red-500" v-if="userAnswers.inferences.length > 1"><i class="ri-close-line"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="px-8 pb-8 pt-4 border-t border-slate-50">
                        <button v-if="!showResult" @click="checkAnswer" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-200">
                            æäº¤æ‹†è§£
                        </button>
                        
                        <div v-else class="space-y-6 animate-fade-in">
                            <div class="grid md:grid-cols-2 gap-6 text-sm">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <div class="font-bold text-green-800 mb-2">å‚è€ƒäº‹å® (F):</div>
                                    <ul class="list-disc list-inside text-green-700 space-y-1">
                                        <li v-for="f in currentQuestion.refFacts">{{ f }}</li>
                                    </ul>
                                </div>
                                <div class="bg-amber-50 p-4 rounded-lg border border-amber-100">
                                    <div class="font-bold text-amber-800 mb-2">å‚è€ƒæ¨æ–­ (I):</div>
                                    <ul class="list-disc list-inside text-amber-700 space-y-1">
                                        <li v-for="i in currentQuestion.refInferences">{{ i }}</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-slate-800 text-slate-200 p-5 rounded-lg text-sm leading-relaxed">
                                <span class="text-yellow-400 font-bold mr-1">ğŸ’¡ è§£æ:</span>
                                {{ currentQuestion.analysis }}
                            </div>

                            <button @click="nextQuestion" class="w-full bg-slate-800 text-white py-3 rounded-lg font-bold hover:bg-slate-900 transition flex justify-center items-center gap-2">
                                {{ isLastQuestion ? 'å®Œæˆå…³å¡' : 'ä¸‹ä¸€é¢˜' }} <i class="ri-arrow-right-line"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-else-if="view === 'summary'" class="text-center py-20 animate-fade-in">
                <div class="inline-block p-6 rounded-full bg-green-100 text-green-600 mb-6 text-6xl">
                    <i class="ri-trophy-fill"></i>
                </div>
                <h2 class="text-3xl font-bold text-slate-800 mb-2">å…³å¡å®Œæˆï¼</h2>
                <p class="text-slate-500 mb-8">ä½ å·²ç»æˆåŠŸæ‹†è§£äº† 10 ä¸ªé€»è¾‘é™·é˜±ã€‚</p>
                <button @click="view = 'menu'" class="bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-indigo-700 transition">
                    è¿”å›å…³å¡åˆ—è¡¨
                </button>
            </div>

            <div v-else-if="view === 'free'" class="max-w-3xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">è‡ªç”±åˆ†æå·¥ä½œå°</h2>
                        <button @click="view = 'menu'" class="text-sm text-slate-500 hover:text-indigo-600">é€€å‡º</button>
                    </div>
                    <textarea v-model="freeText" class="w-full h-32 p-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none mb-4" placeholder="è¾“å…¥ä»»æ„æ®µè½..."></textarea>
                    <button @click="startFreeAnalysis" class="bg-indigo-600 text-white px-6 py-2 rounded-lg">æ‹†è§£</button>
                    
                    <div v-if="freeSegments.length > 0" class="mt-8 space-y-6">
                        <div v-for="(seg, idx) in freeSegments" :key="idx" class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                            <p class="mb-3 font-serif text-lg">{{ seg.original }}</p>
                            <div class="grid grid-cols-2 gap-4">
                                <textarea class="w-full h-20 p-2 text-sm border rounded focus:border-green-500 outline-none" placeholder="F: äº‹å®..."></textarea>
                                <textarea class="w-full h-20 p-2 text-sm border rounded focus:border-amber-500 outline-none" placeholder="I: æ¨æ–­..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        const { createApp, ref, reactive, computed, onMounted } = Vue;

        // --- æ ¸å¿ƒæ•°æ®ç”Ÿæˆå™¨ (ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ç”Ÿæˆ30æ¡æ•°æ®) ---
        // å®é™…éƒ¨ç½²æ—¶ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ª DATA æ›¿æ¢ä¸ºä» data.json è¯»å–
        const RAW_DATA = [
            // Level 1: åŸºç¡€å½’å› ä¸æƒ…ç»ª
            { t: "ä»–ä»Šå¤©è¿Ÿåˆ°ï¼Œåº”è¯¥æ˜¯æ˜¨æ™šç¡å¤ªæ™šã€‚", f: ["ä»–ä»Šå¤©è¿Ÿåˆ°"], i: ["ä»–æ˜¨æ™šç¡å¾—æ™š", "è¿Ÿåˆ°æ˜¯å› ä¸ºç¡å¾—æ™š"], tag: "å› æœå½’å› ", d: "å…¥é—¨", a: "æœªç»éªŒè¯çš„å› æœè”ç³»å±äºæ¨æ–­ã€‚" },
            { t: "è¿™åŒé‹å¤ªè´µäº†ï¼Œæ ¹æœ¬ä¸å€¼è¿™ä¸ªä»·ã€‚", f: ["é‹æ ‡ä»·Xå…ƒ"], i: ["å¤ªè´µäº†(ä¸»è§‚)", "ä¸å€¼è¿™ä¸ªä»·(ä»·å€¼åˆ¤æ–­)"], tag: "ä»·å€¼åˆ¤æ–­", d: "å…¥é—¨", a: "â€˜è´µâ€™æ˜¯ç›¸å¯¹äºæ¶ˆè´¹èƒ½åŠ›çš„è¯„ä»·ã€‚" },
            { t: "è€æ¿å¼€ä¼šä¸€ç›´çš±çœ‰ï¼Œè‚¯å®šæ˜¯å¯¹æ–¹æ¡ˆä¸æ»¡ã€‚", f: ["è€æ¿çš±çœ‰"], i: ["è€æ¿ä¸æ»¡æ„", "çš±çœ‰æ˜¯å› ä¸ºä¸æ»¡"], tag: "è¯»å¿ƒæœ¯", d: "å…¥é—¨", a: "å¾®è¡¨æƒ…ä¸ç­‰äºå†…å¿ƒæƒ³æ³•ï¼Œä¹Ÿè®¸ä»–åªæ˜¯å¤´ç–¼ã€‚" },
            { t: "ä»–æ²¡å›æˆ‘æ¶ˆæ¯ï¼Œçœ‹æ¥æ˜¯ä¸æƒ³ç†æˆ‘ã€‚", f: ["ä»–æœªå›å¤æ¶ˆæ¯"], i: ["ä»–ä¸æƒ³ç†æˆ‘"], tag: "è¯»å¿ƒæœ¯", d: "å…¥é—¨", a: "æœªå›å¤æ˜¯äº‹å®ï¼Œä¸æƒ³ç†æ˜¯çŒœæµ‹åŠ¨æœºã€‚" },
            { t: "è¿™å®¶é¤å…æ’é˜Ÿè¿™ä¹ˆé•¿ï¼Œå‘³é“ä¸€å®šå¾ˆå¥½ã€‚", f: ["é¤å…æ’é•¿é˜Ÿ"], i: ["å‘³é“å¾ˆå¥½"], tag: "ç›¸å…³æ€§", d: "å…¥é—¨", a: "æ’é˜Ÿå¯èƒ½æ˜¯å› ä¸ºæœåŠ¡æ…¢æˆ–è¥é”€ï¼Œä¸ç­‰äºå‘³é“å¥½ã€‚" },
            { t: "å¦‚æœä¸åŠªåŠ›è¯»ä¹¦ï¼Œé•¿å¤§å°±åªèƒ½æ‰«å¤§è¡—ã€‚", f: ["å¦‚æœä¸åŠªåŠ›è¯»ä¹¦(å‡è®¾æ¡ä»¶)"], i: ["é•¿å¤§åªèƒ½æ‰«å¤§è¡—"], tag: "æ»‘å¡è°¬è¯¯", d: "å…¥é—¨", a: "è¿‡åº¦ç®€åŒ–çš„äºŒå…ƒå¯¹ç«‹æ¨æ–­ã€‚" },
            { t: "ä»–å…¨èº«åç‰Œï¼Œä¸€å®šæ˜¯ä¸ªå¯ŒäºŒä»£ã€‚", f: ["ä»–ç©¿åç‰Œ"], i: ["ä»–æ˜¯å¯ŒäºŒä»£"], tag: "åˆ»æ¿å°è±¡", d: "å…¥é—¨", a: "ç©¿ç€æ˜¯è¡¨è±¡ï¼Œèº«ä»½æ˜¯æ¨æ–­ã€‚" },
            { t: "ä»Šå¤©çœ¼çš®ä¸€ç›´è·³ï¼Œæ„Ÿè§‰è¦æœ‰åäº‹å‘ç”Ÿã€‚", f: ["çœ¼çš®è·³"], i: ["è¦æœ‰åäº‹å‘ç”Ÿ"], tag: "è¿·ä¿¡å…³è”", d: "å…¥é—¨", a: "ç”Ÿç†ç°è±¡ä¸æœªæ¥è¿æ°”æ— å› æœå…³ç³»ã€‚" },
            { t: "å¤§å®¶éƒ½è¯´è¿™ç”µå½±å¥½çœ‹ï¼Œé‚£è‚¯å®šæ²¡é”™ã€‚", f: ["å¤§å®¶éƒ½è¯´å¥½çœ‹"], i: ["ç”µå½±ç¡®å®å¥½"], tag: "ä»ä¼—å¿ƒç†", d: "å…¥é—¨", a: "åˆ«äººçš„è¯„ä»·å¯¹ä½ æ¥è¯´åªæ˜¯å‚è€ƒä¿¡æ¯ï¼Œéå®¢è§‚äº‹å®ã€‚" },
            { t: "ä»–è¿™ä¹ˆå¹´è½»å°±å½“ç»ç†ï¼Œè‚¯å®šæœ‰èƒŒæ™¯ã€‚", f: ["ä»–å¹´è½»", "ä»–æ˜¯ç»ç†"], i: ["ä»–æœ‰èƒŒæ™¯"], tag: "å½’å› åå·®", d: "å…¥é—¨", a: "å¿½ç•¥äº†èƒ½åŠ›å› ç´ çš„æ¨æ–­ã€‚" },

            // Level 2: å•†ä¸šä¸æ•°æ®é™·é˜±
            { t: "é”€é‡ä¸‹é™20%ï¼Œæˆ‘ä»¬çš„ç­–ç•¥å®Œå…¨å¤±è´¥äº†ã€‚", f: ["é”€é‡é™20%"], i: ["ç­–ç•¥å¤±è´¥", "å®Œå…¨å¤±è´¥"], tag: "æ•°æ®è§£è¯»", d: "è¿›é˜¶", a: "ä¸‹é™å¯èƒ½æºäºå¸‚åœºç¯å¢ƒï¼Œâ€˜å®Œå…¨â€™æ˜¯æƒ…ç»ªè¯ã€‚" },
            { t: "åªè¦ä½¿ç”¨äº†æˆ‘ä»¬çš„äº§å“ï¼Œä¸šç»©å°±èƒ½ç¿»å€ã€‚", f: ["ä½¿ç”¨äº†äº§å“(å‡è®¾)"], i: ["ä¸šç»©ç¿»å€"], tag: "è¿‡åº¦æ‰¿è¯º", d: "è¿›é˜¶", a: "è¿™æ˜¯é”€å”®è¯æœ¯ï¼ˆIï¼‰ï¼Œè€Œéäº§å“è¯´æ˜ä¹¦ï¼ˆFï¼‰ã€‚" },
            { t: "ç«äº‰å¯¹æ‰‹é™ä»·äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»é™ä»·ã€‚", f: ["å¯¹æ‰‹é™ä»·"], i: ["æˆ‘ä»¬å¿…é¡»é™ä»·"], tag: "å†³ç­–æ¨æ–­", d: "è¿›é˜¶", a: "â€˜å¿…é¡»â€™æ˜¯æ¨æ–­å‡ºçš„å¿…è¦æ€§ï¼Œä¹Ÿè®¸å¯ä»¥å·®å¼‚åŒ–ç«äº‰ã€‚" },
            { t: "ç”¨æˆ·åœç•™æ—¶é•¿å¢åŠ ï¼Œè¯´æ˜ä»–ä»¬æ›´å–œæ¬¢æ–°ç‰ˆã€‚", f: ["åœç•™æ—¶é•¿å¢åŠ "], i: ["ç”¨æˆ·æ›´å–œæ¬¢"], tag: "æŒ‡æ ‡è¯¯è¯»", d: "è¿›é˜¶", a: "ä¹Ÿè®¸æ˜¯å› ä¸ºæ–°ç‰ˆå¾ˆéš¾ç”¨ï¼Œæ‰¾ä¸åˆ°æŒ‰é’®ã€‚" },
            { t: "ä»–æ˜¯å“ˆä½›æ¯•ä¸šçš„ï¼Œèƒ½åŠ›ä¸€å®šå¾ˆå¼ºã€‚", f: ["ä»–æ˜¯å“ˆä½›æ¯•ä¸š"], i: ["èƒ½åŠ›å¼º"], tag: "å…‰ç¯æ•ˆåº”", d: "è¿›é˜¶", a: "å­¦å†æ˜¯èƒŒæ™¯ï¼Œèƒ½åŠ›æ˜¯å½“å‰è¡¨ç°ã€‚" },
            { t: "è¿™æ¬¡æ´»åŠ¨æ²¡äººæŠ¥åï¼Œçœ‹æ¥å¤§å®¶å¯¹è¿™ä¸ªè¯é¢˜ä¸æ„Ÿå…´è¶£ã€‚", f: ["æ²¡äººæŠ¥å"], i: ["å¤§å®¶å¯¹è¯é¢˜ä¸æ„Ÿå…´è¶£"], tag: "å½’å› é”™è¯¯", d: "è¿›é˜¶", a: "ä¹Ÿè®¸æ˜¯æ¨å¹¿æ¸ é“é”™äº†ï¼Œæˆ–è€…æ—¶é—´ä¸å¯¹ã€‚" },
            { t: "è‚¡ä»·è¿ç»­æ¶¨åœï¼Œè¿™å®¶å…¬å¸å‰æ™¯ä¸€ç‰‡å¤§å¥½ã€‚", f: ["è‚¡ä»·æ¶¨åœ"], i: ["å‰æ™¯å¤§å¥½"], tag: "å¸‚åœºæƒ…ç»ª", d: "è¿›é˜¶", a: "è‚¡ä»·åæ˜ çš„æ˜¯æƒ…ç»ªï¼Œä¸å®Œå…¨ç­‰åŒäºåŸºæœ¬é¢ã€‚" },
            { t: "æ—¢ç„¶å¤§å®¶éƒ½åŒæ„ï¼Œé‚£è¿™ä¸ªæ–¹æ¡ˆä¸€å®šæ²¡é—®é¢˜ã€‚", f: ["å¤§å®¶éƒ½åŒæ„"], i: ["æ–¹æ¡ˆæ²¡é—®é¢˜"], tag: "ç¾¤ä½“è¿·æ€", d: "è¿›é˜¶", a: "å…±è¯†ä¸ä»£è¡¨çœŸç†ï¼Œå¯èƒ½åªæ˜¯æ²¡äººæ•¢åå¯¹ã€‚" },
            { t: "å¦‚æœä¸è£å‘˜ï¼Œå…¬å¸å°±ä¼šå€’é—­ã€‚", f: ["å¦‚æœä¸è£å‘˜(å‡è®¾)"], i: ["å…¬å¸ä¼šå€’é—­"], tag: "è™šå‡ä¸¤éš¾", d: "è¿›é˜¶", a: "ä¹Ÿè®¸è¿˜æœ‰é™è–ªã€ç¼©å‡å¼€æ”¯ç­‰å…¶ä»–è·¯ã€‚" },
            { t: "ä¹‹å‰ç±»ä¼¼é¡¹ç›®éƒ½æˆåŠŸäº†ï¼Œè¿™æ¬¡ä¹Ÿç¨³äº†ã€‚", f: ["ä¹‹å‰é¡¹ç›®æˆåŠŸ"], i: ["è¿™æ¬¡ä¹Ÿç¨³äº†"], tag: "å½’çº³è°¬è¯¯", d: "è¿›é˜¶", a: "å†å²æ•°æ®ä¸èƒ½100%é¢„æµ‹æœªæ¥ã€‚" },

            // Level 3: é€»è¾‘æ¼æ´ä¸è®¤çŸ¥åå·®
            { t: "ä»–åå¯¹æˆ‘çš„ææ¡ˆï¼Œå°±æ˜¯é’ˆå¯¹æˆ‘ä¸ªäººã€‚", f: ["ä»–åå¯¹ææ¡ˆ"], i: ["é’ˆå¯¹æˆ‘ä¸ªäºº"], tag: "é’ˆå¯¹äººèº«", d: "å›°éš¾", a: "æ··æ·†äº†å¯¹äº‹çš„åå¯¹å’Œå¯¹äººçš„æ”»å‡»ã€‚" },
            { t: "ä½ æ²¡ç»å†è¿‡ï¼Œæ‰€ä»¥ä½ æ²¡èµ„æ ¼è¯„ä»·ã€‚", f: ["ä½ æ²¡ç»å†è¿‡"], i: ["ä½ æ²¡èµ„æ ¼è¯„ä»·"], tag: "èµ„æ ¼è®º", d: "å›°éš¾", a: "è¯„ä»·çš„æœ‰æ•ˆæ€§å–å†³äºé€»è¾‘ï¼Œä¸å®Œå…¨å–å†³äºç»å†ã€‚" },
            { t: "è™½ç„¶æ²¡æœ‰è¯æ®è¯æ˜ç”±äºä»–åšçš„ï¼Œä½†ä¹Ÿæ²¡æœ‰è¯æ®è¯æ˜ä¸æ˜¯ä»–ã€‚", f: ["æ— è¯æ®è¯æ˜æ˜¯ä»–", "æ— è¯æ®è¯æ˜ä¸æ˜¯ä»–"], i: ["æ‰€ä»¥å¯èƒ½å°±æ˜¯ä»–"], tag: "è¯‰è¯¸æ— çŸ¥", d: "å›°éš¾", a: "æ— æ³•è¯ä¼ªä¸ä»£è¡¨è¯å®ã€‚" },
            { t: "è‡ªç„¶çš„å°±æ˜¯æœ€å¥½çš„ï¼Œäººå·¥æ·»åŠ å‰‚éƒ½æœ‰æ¯’ã€‚", f: ["äººå·¥æ·»åŠ å‰‚"], i: ["è‡ªç„¶çš„æœ€å¥½", "äººå·¥çš„æœ‰æ¯’"], tag: "è‡ªç„¶è°¬è¯¯", d: "å›°éš¾", a: "è‡ªç„¶ç•Œä¹Ÿæœ‰æ¯’è˜‘è‡ï¼Œäººå·¥ä¹Ÿæœ‰æ•‘å‘½è¯ã€‚" },
            { t: "å¦‚æœå…è®¸åŒæ€§å©šå§»ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸æ˜¯å°±è¦å…è®¸å’ŒåŠ¨ç‰©ç»“å©šï¼Ÿ", f: ["å…è®¸åŒæ€§å©šå§»(å‡è®¾)"], i: ["æ¥ä¸‹æ¥å…è®¸å’ŒåŠ¨ç‰©ç»“å©š"], tag: "æ»‘å¡è°¬è¯¯", d: "å›°éš¾", a: "ç»å…¸çš„é€»è¾‘æ»‘å¡ï¼Œä¸¤è€…æ²¡æœ‰å¿…ç„¶é€’è¿›å…³ç³»ã€‚" },
            { t: "çœŸæ­£çš„è‹æ ¼å…°äººä¸ä¼šåœ¨ç²¥é‡Œæ”¾ç³–ã€‚", f: ["æœ‰äººåœ¨ç²¥é‡Œæ”¾ç³–"], i: ["ä»–ä¸æ˜¯çœŸæ­£çš„è‹æ ¼å…°äºº"], tag: "çº¯æ­£è‹æ ¼å…°äººè°¬è¯¯", d: "å›°éš¾", a: "é€šè¿‡ä¿®æ”¹å®šä¹‰æ¥ç»´æŠ¤è®ºç‚¹ã€‚" },
            { t: "è¿™è¯æ˜¯ç¥–ä¼ ç§˜æ–¹ï¼Œè‚¯å®šæœ‰æ•ˆã€‚", f: ["æ˜¯ç¥–ä¼ ç§˜æ–¹"], i: ["æœ‰æ•ˆ"], tag: "è¯‰è¯¸ä¼ ç»Ÿ", d: "å›°éš¾", a: "ä¼ ç»Ÿä¸ç­‰äºç§‘å­¦éªŒè¯çš„æœ‰æ•ˆæ€§ã€‚" },
            { t: "ä¸“å®¶éƒ½è¿™ä¹ˆè¯´ï¼Œä½ æ€ä¹ˆæ•¢åé©³ï¼Ÿ", f: ["ä¸“å®¶è¿™ä¹ˆè¯´"], i: ["ä½ ä¸èƒ½åé©³"], tag: "è¯‰è¯¸æƒå¨", d: "å›°éš¾", a: "æƒå¨ä¹Ÿå¯èƒ½çŠ¯é”™ï¼Œè§‚ç‚¹éœ€è¦é€»è¾‘æ”¯æ’‘ã€‚" },
            { t: "è¦ä¹ˆå…¨åŠ›ä»¥èµ´ï¼Œè¦ä¹ˆç›´æ¥æ”¾å¼ƒã€‚", f: ["..."], i: ["åªæœ‰è¿™ä¸¤ç§é€‰æ‹©"], tag: "éé»‘å³ç™½", d: "å›°éš¾", a: "å¿½ç•¥äº†ä¸­é—´åœ°å¸¦çš„å¯èƒ½æ€§ã€‚" },
            { t: "çœ‹äº†é‚£ä¹ˆå¤šæˆåŠŸå­¦ï¼Œæˆ‘ä¹Ÿèƒ½æˆåŠŸã€‚", f: ["çœ‹äº†æˆåŠŸå­¦"], i: ["æˆ‘èƒ½æˆåŠŸ"], tag: "å¹¸å­˜è€…åå·®", d: "å›°éš¾", a: "å¿½ç•¥äº†æ¨¡ä»¿çš„éš¾åº¦å’Œç¯å¢ƒå˜é‡ã€‚" }
        ];

        createApp({
            setup() {
                const view = ref('menu'); // menu, training, summary, free
                
                // å…³å¡æ•°æ®ç»“æ„
                const levels = ref([]);
                const levelStatus = ref({}); // è®°å½•è§£é”çŠ¶æ€ {0: true, 1: false...}

                // è®­ç»ƒçŠ¶æ€
                const currentLevelIndex = ref(0);
                const currentLevelData = ref([]);
                const currentQIndex = ref(0);
                const currentQuestion = ref({});
                const showResult = ref(false);
                const userAnswers = reactive({ facts: [''], inferences: [''] });

                // è‡ªç”±æ¨¡å¼
                const freeText = ref('');
                const freeSegments = ref([]);

                // åˆå§‹åŒ–ï¼šå°†æ•°æ®åˆ‡åˆ†ä¸ºæ¯ç»„10ä¸ª
                onMounted(() => {
                    const chunkSize = 10;
                    for (let i = 0; i < RAW_DATA.length; i += chunkSize) {
                        levels.value.push(RAW_DATA.slice(i, i + chunkSize));
                    }
                    // é»˜è®¤è§£é”ç¬¬ä¸€å…³
                    levelStatus.value[0] = true; 
                });

                // åˆ¤æ–­å…³å¡æ˜¯å¦é”å®š
                const isLocked = (idx) => {
                    // å¦‚æœä¸Šä¸€å…³æ²¡å®Œæˆï¼ˆè¿™é‡Œç®€åŒ–é€»è¾‘ï¼šåªè¦åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œå°±æ˜¯è§£é”äº†ï¼Œå®é™…å¯ä»¥åšlocalStorageå­˜å‚¨ï¼‰
                    // è¿™é‡Œç®€åŒ–ï¼šç›®å‰åªè§£é”ç¬¬ä¸€å…³ï¼Œæˆ–è€…ä¸Šä¸€å…³å®Œæˆåè§£é”ä¸‹ä¸€å…³
                    return !levelStatus.value[idx];
                };

                const getLevelTitle = (idx) => {
                    const titles = ["åˆé˜¶ï¼šæ—¥å¸¸è¿·æ€", "è¿›é˜¶ï¼šèŒåœºä¸å•†ä¸š", "é«˜é˜¶ï¼šè®¤çŸ¥é™·é˜±"];
                    return titles[idx] || `è®­ç»ƒå…³å¡ ${idx + 1}`;
                };

                // å¼€å§‹å…³å¡
                const startLevel = (idx) => {
                    if (isLocked(idx)) return;
                    
                    currentLevelIndex.value = idx;
                    // å¤åˆ¶ä¸€ä»½æ•°æ®å¹¶éšæœºæ‰“ä¹±é¢˜ç›®é¡ºåº
                    const rawQuestions = levels.value[idx];
                    // ç®€å•çš„éšæœºæ´—ç‰Œç®—æ³•
                    currentLevelData.value = [...rawQuestions].sort(() => Math.random() - 0.5);
                    
                    currentQIndex.value = 0;
                    loadQuestion();
                    view.value = 'training';
                };

                const loadQuestion = () => {
                    const q = currentLevelData.value[currentQIndex.value];
                    currentQuestion.value = {
                        text: q.t,
                        tag: q.tag,
                        difficulty: q.d,
                        refFacts: q.f,
                        refInferences: q.i,
                        analysis: q.a
                    };
                    // é‡ç½®è¾“å…¥
                    userAnswers.facts = [''];
                    userAnswers.inferences = [''];
                    showResult.value = false;
                    window.scrollTo(0, 0);
                };

                // è¾“å…¥æ¡†ç®¡ç†
                const addInput = (type) => userAnswers[type].push('');
                const removeInput = (type, idx) => userAnswers[type].splice(idx, 1);

                // æ£€æŸ¥ç­”æ¡ˆ
                const checkAnswer = () => {
                    showResult.value = true;
                    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨çœ‹è§£æ
                    setTimeout(() => {
                        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                    }, 100);
                };

                // ä¸‹ä¸€é¢˜
                const nextQuestion = () => {
                    if (currentQIndex.value < currentLevelData.value.length - 1) {
                        currentQIndex.value++;
                        loadQuestion();
                    } else {
                        // å…³å¡å®Œæˆ
                        finishLevel();
                    }
                };

                // å…³å¡ç»“ç®—
                const finishLevel = () => {
                    // è§£é”ä¸‹ä¸€å…³
                    if (currentLevelIndex.value < levels.value.length - 1) {
                        levelStatus.value[currentLevelIndex.value + 1] = true;
                    }
                    view.value = 'summary';
                };

                // è‡ªç”±æ¨¡å¼é€»è¾‘
                const startFreeAnalysis = () => {
                    if (!freeText.value) return;
                    const parts = freeText.value.split(/([ã€‚ï¼ï¼Ÿ.!?]+)/);
                    freeSegments.value = [];
                    for (let i = 0; i < parts.length; i += 2) {
                        const s = parts[i].trim();
                        if (s) freeSegments.value.push({ original: s });
                    }
                };

                return {
                    view, levels, levelStatus,
                    currentLevelIndex, currentLevelData, currentQIndex, currentQuestion,
                    userAnswers, showResult,
                    isLastQuestion: computed(() => currentQIndex.value >= currentLevelData.value.length - 1),
                    isLocked, getLevelTitle, startLevel,
                    addInput, removeInput, checkAnswer, nextQuestion,
                    // Free Mode
                    freeText, freeSegments, startFreeAnalysis
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
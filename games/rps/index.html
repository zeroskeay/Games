<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èŒèŒçŒœæ‹³ï¼šç”Ÿå­˜å¤§æŒ‘æˆ˜</title>
    <style>
        /* --- åŸºç¡€å˜é‡ --- */
        :root {
            --bg-color: #FFF5F7; /* æµ…ç²‰èƒŒæ™¯ */
            --card-bg: #ffffff;
            --primary: #FF8FAB; /* ç³–æœç²‰ */
            --primary-dark: #FB6F92;
            --accent: #FFE29F; /* å¥¶æ²¹é»„ */
            --text-main: #590D22;
            --text-light: #A4133C;
            --win-color: #80B918;
            --lose-color: #E63946;
        }

        body {
            margin: 0;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif; /* å¯çˆ±å­—ä½“ */
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden; /* é˜²æ­¢å½©è›‹æº¢å‡ºæ»šåŠ¨æ¡ */
            touch-action: manipulation;
        }

        /* --- é¡¶éƒ¨ï¼šç”µè„‘åŒºåŸŸ --- */
        .computer-area {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .avatar-label {
            font-size: 0.9rem;
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(255, 143, 171, 0.4);
        }

        .computer-bubble {
            width: 100px;
            height: 100px;
            background: white;
            border: 4px solid var(--primary);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        /* --- ä¸­é—´ï¼šçŠ¶æ€æ¡ --- */
        .status-bar {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .stat-pill {
            background: #fff;
            padding: 8px 20px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 2px solid var(--accent);
        }

        .streak-box {
            color: #FF9E00;
            display: none; /* è¿èƒœæ—¶æ‰æ˜¾ç¤º */
        }

        /* --- æ¸¸æˆåé¦ˆæ–‡å­— --- */
        .message-area {
            height: 40px;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- åº•éƒ¨ï¼šç©å®¶æ“ä½œåŒº --- */
        .player-area {
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding-bottom: 30px;
        }

        .choice-card {
            background: white;
            border: 3px solid #eee;
            border-radius: 20px;
            width: 80px;
            height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 4px 0 #ddd;
        }

        .choice-card span {
            font-size: 2.5rem;
            pointer-events: none;
        }

        /* é€‰ä¸­çŠ¶æ€ */
        .choice-card.selected {
            border-color: var(--primary-dark);
            background-color: #FFF0F5;
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(251, 111, 146, 0.3);
        }

        /* æœªé€‰ä¸­çŠ¶æ€ï¼ˆå˜æ·¡ï¼‰ */
        .choice-card.dimmed {
            opacity: 0.5;
            transform: scale(0.9);
            box-shadow: none;
        }

        /* --- å¼¹çª— (Game Over) --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background: white;
            width: 80%;
            max-width: 320px;
            border-radius: 30px;
            padding: 30px;
            text-align: center;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary);
        }

        .modal-score {
            font-size: 3rem;
            color: var(--primary-dark);
            margin: 10px 0;
            font-weight: 900;
        }

        .restart-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 4px 0 #E04F70;
            transition: transform 0.1s;
        }
        .restart-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* --- åŠ¨ç”» --- */
        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }
        
        .shaking { animation: shake 0.4s infinite; }

        /* å½©è›‹å…ƒç´  */
        .emoji-rain {
            position: fixed;
            top: -50px;
            font-size: 2rem;
            z-index: 50;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to { transform: translateY(110vh); }
        }
    </style>
</head>
<body>

    <div class="computer-area">
        <div class="avatar-label">ğŸ¤– å‘†å‘†æœºå™¨äºº</div>
        <div class="computer-bubble" id="comp-bubble">â”</div>
    </div>

    <div class="status-bar">
        <div class="stat-pill">å¾—åˆ†: <span id="score-val">0</span></div>
        <div class="stat-pill streak-box" id="streak-box">ğŸ”¥ è¿èƒœ: <span id="streak-val">0</span></div>
    </div>

    <div class="message-area" id="msg-area">è¯·å‡ºæ‹³...</div>

    <div class="player-area" id="player-controls">
        <div class="choice-card" onclick="playGame('rock', this)">
            <span>âœŠ</span>
        </div>
        <div class="choice-card" onclick="playGame('scissors', this)">
            <span>âœŒï¸</span>
        </div>
        <div class="choice-card" onclick="playGame('paper', this)">
            <span>âœ‹</span>
        </div>
    </div>

    <div class="modal-overlay" id="game-over-modal">
        <div class="modal-content">
            <h2>ğŸ˜¢ æŒ‘æˆ˜ç»“æŸ</h2>
            <p>å“å‘€ï¼Œè¾“ç»™æœºå™¨äººäº†...</p>
            <div class="modal-score" id="final-score">0</div>
            <p>æœ¬å±€å¾—åˆ†</p>
            <button class="restart-btn" onclick="resetGame()">å†æ¥ä¸€å±€ï¼</button>
        </div>
    </div>

    <script>
        /* --- æ¸¸æˆçŠ¶æ€ --- */
        let score = 0;
        let streak = 0;
        let isPlaying = false; // é˜²æ­¢è¿ç‚¹

        const symbols = { 'rock': 'âœŠ', 'scissors': 'âœŒï¸', 'paper': 'âœ‹' };
        const compBubble = document.getElementById('comp-bubble');
        const msgArea = document.getElementById('msg-area');
        const scoreVal = document.getElementById('score-val');
        const streakBox = document.getElementById('streak-box');
        const streakVal = document.getElementById('streak-val');
        const modal = document.getElementById('game-over-modal');

        // --- ğŸ”Š éŸ³æ•ˆç³»ç»Ÿ (Web Audio API) ---
        // ä¸éœ€è¦å¤–éƒ¨æ–‡ä»¶ï¼Œä»£ç ç”Ÿæˆçš„éŸ³æ•ˆ
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'win') {
                // æ¬¢å¿«çš„ä¸Šè¡ŒéŸ³ (Do-Mi-Sol)
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(523.25, now); // C5
                osc.frequency.setValueAtTime(659.25, now + 0.1); // E5
                osc.frequency.setValueAtTime(783.99, now + 0.2); // G5
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'lose') {
                // å¤±æœ›çš„æ»‘éŸ³
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now); 
                osc.frequency.linearRampToValueAtTime(50, now + 0.4); // ä¸‹æ»‘
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0.01, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'draw') {
                // é—·é—·çš„å£°éŸ³
                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0.01, now + 0.15);
                osc.start(now);
                osc.stop(now + 0.15);
            } else if (type === 'cheer') {
                // è¿èƒœå½©è›‹éŸ³æ•ˆ (å¿«é€Ÿç¶éŸ³)
                osc.type = 'square';
                osc.frequency.setValueAtTime(880, now);
                osc.frequency.setValueAtTime(1109, now + 0.1);
                osc.frequency.setValueAtTime(1318, now + 0.2);
                osc.frequency.setValueAtTime(1760, now + 0.3);
                gainNode.gain.setValueAtTime(0.05, now);
                gainNode.gain.linearRampToValueAtTime(0.001, now + 0.6);
                osc.start(now);
                osc.stop(now + 0.6);
            }
        }

        // --- ğŸ® æ ¸å¿ƒç©æ³• ---
        function playGame(userChoice, element) {
            if (isPlaying) return;
            isPlaying = true;
            
            // 1. UI äº¤äº’ï¼šé«˜äº®é€‰ä¸­ï¼Œè™šåŒ–å…¶ä»–
            const cards = document.querySelectorAll('.choice-card');
            cards.forEach(c => {
                if(c === element) {
                    c.classList.add('selected');
                    c.classList.remove('dimmed');
                } else {
                    c.classList.remove('selected');
                    c.classList.add('dimmed');
                }
            });

            msgArea.innerText = "ğŸ¤– æ€è€ƒä¸­...";
            msgArea.style.color = "#aaa";
            
            // ç”µè„‘å‡è£…æ€è€ƒåŠ¨ç”»
            compBubble.classList.add('shaking');
            compBubble.innerText = 'âœŠ'; // æ€è€ƒæ—¶æš‚æ—¶æ˜¾ç¤ºæ‹³å¤´

            setTimeout(() => {
                compBubble.classList.remove('shaking');
                
                // 2. ç”µè„‘å‡ºæ‹³
                const choices = ['rock', 'scissors', 'paper'];
                const compChoice = choices[Math.floor(Math.random() * 3)];
                compBubble.innerText = symbols[compChoice];

                // 3. åˆ¤å®šç»“æœ
                const result = getResult(userChoice, compChoice);
                handleResult(result);

                // 4. å¦‚æœæ²¡æœ‰Game Overï¼Œæ¢å¤ç‚¹å‡»çŠ¶æ€
                if (result !== 'lose') {
                    setTimeout(() => {
                        isPlaying = false;
                        resetUIState(); // æ¢å¤æŒ‰é’®çŠ¶æ€
                    }, 1200); // 1.2ç§’åæ¢å¤ï¼Œè®©ç©å®¶çœ‹æ¸…ç»“æœ
                }

            }, 600); // æ€è€ƒæ—¶é—´
        }

        function getResult(u, c) {
            if (u === c) return 'draw';
            if ((u === 'rock' && c === 'scissors') || 
                (u === 'scissors' && c === 'paper') || 
                (u === 'paper' && c === 'rock')) {
                return 'win';
            }
            return 'lose';
        }

        function handleResult(result) {
            if (result === 'win') {
                score++;
                streak++;
                scoreVal.innerText = score;
                updateStreak();
                msgArea.innerText = "ğŸ‰ èµ¢å•¦ï¼ç»§ç»­ä¿æŒï¼";
                msgArea.style.color = "var(--win-color)";
                playSound('win');

                // è¿èƒœå½©è›‹æ£€æµ‹
                if (streak === 3) {
                    setTimeout(() => {
                        triggerConfetti();
                        playSound('cheer');
                        msgArea.innerText = "ğŸ”¥ğŸ”¥ 3è¿èƒœï¼æ‰‹æ°”çˆ†ç‚¸ï¼";
                    }, 300);
                }

            } else if (result === 'draw') {
                msgArea.innerText = "ğŸ¤ å¹³å±€ï¼Œå†è¯•ä¸€æ¬¡";
                msgArea.style.color = "gray";
                playSound('draw');
                // å¹³å±€é€šå¸¸ä¸æ‰“æ–­è¿èƒœï¼Œä¹Ÿä¸åŠ åˆ†
            } else {
                // è¾“äº† -> Game Over
                msgArea.innerText = "ğŸ’¥ è¢«æ‰“è´¥äº†...";
                msgArea.style.color = "var(--lose-color)";
                playSound('lose');
                setTimeout(() => {
                    showGameOver();
                }, 800);
            }
        }

        // --- è¾…åŠ©åŠŸèƒ½ ---

        function updateStreak() {
            if (streak >= 2) {
                streakBox.style.display = 'block';
                streakVal.innerText = streak;
            } else {
                streakBox.style.display = 'none';
            }
        }

        function resetUIState() {
            const cards = document.querySelectorAll('.choice-card');
            cards.forEach(c => {
                c.classList.remove('selected', 'dimmed');
            });
            msgArea.innerText = "è¯·å‡ºæ‹³...";
            msgArea.style.color = "var(--text-main)";
            compBubble.innerText = 'â”';
        }

        function showGameOver() {
            document.getElementById('final-score').innerText = score;
            modal.style.display = 'flex';
        }

        function resetGame() {
            score = 0;
            streak = 0;
            isPlaying = false;
            scoreVal.innerText = '0';
            updateStreak();
            modal.style.display = 'none';
            resetUIState();
        }

        // --- ğŸŠ è¿èƒœå½©è›‹ï¼šEmoji é›¨ ---
        function triggerConfetti() {
            const emojis = ['ğŸ‰', 'ğŸ”¥', 'ğŸ†', 'âœ¨', 'ğŸ˜'];
            for (let i = 0; i < 30; i++) {
                const el = document.createElement('div');
                el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                el.className = 'emoji-rain';
                el.style.left = Math.random() * 100 + 'vw';
                el.style.animationDuration = (Math.random() * 2 + 1) + 's'; // 1-3s duration
                el.style.fontSize = (Math.random() * 1 + 1.5) + 'rem';
                document.body.appendChild(el);

                // åŠ¨ç”»ç»“æŸååˆ é™¤å…ƒç´ 
                setTimeout(() => {
                    el.remove();
                }, 3000);
            }
        }
    </script>
</body>
</html>